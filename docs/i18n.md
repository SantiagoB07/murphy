# Internationalization (i18n)

Murphy uses [next-intl](https://next-intl.dev) for internationalization with locale-based routing.

## Overview

- **Supported locales**: Spanish (`es`), English (`en`)
- **Default locale**: Spanish (`es`)
- **Routing**: Prefix-based with `as-needed` strategy
  - Spanish (default): `/dashboard`, `/glucometrias`
  - English: `/en/dashboard`, `/en/glucometrias`

## File Structure

```
apps/web/
â”œâ”€â”€ messages/
â”‚   â”œâ”€â”€ es.json              # Spanish translations (default)
â”‚   â””â”€â”€ en.json              # English translations
â””â”€â”€ src/
    â”œâ”€â”€ i18n/
    â”‚   â”œâ”€â”€ routing.ts       # Locale configuration
    â”‚   â”œâ”€â”€ navigation.ts    # Locale-aware Link, useRouter, etc.
    â”‚   â””â”€â”€ request.ts       # Server-side locale resolution
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ LocaleSwitcher.tsx
    â””â”€â”€ app/
        â””â”€â”€ [locale]/        # All pages live here
            â”œâ”€â”€ layout.tsx
            â””â”€â”€ ...
```

## Adding Translations

### 1. Add keys to message files

**`messages/es.json`** (Spanish - default):
```json
{
  "Dashboard": {
    "title": "Panel de control",
    "welcome": "Bienvenido, {name}"
  }
}
```

**`messages/en.json`** (English):
```json
{
  "Dashboard": {
    "title": "Dashboard",
    "welcome": "Welcome, {name}"
  }
}
```

### 2. Use namespaces to organize

Group related translations under a namespace (e.g., `Dashboard`, `Landing`, `Onboarding`):

```json
{
  "Landing": {
    "hero": {
      "title": "Your health,",
      "titleHighlight": "under control"
    },
    "cta": {
      "signIn": "Sign In",
      "signUp": "Sign Up"
    }
  },
  "Dashboard": {
    "stats": {
      "glucose": "Glucose",
      "insulin": "Insulin"
    }
  }
}
```

## Usage

### Server Components (Recommended)

Use `getTranslations` for async server components:

```tsx
import { getTranslations } from "next-intl/server"

export default async function DashboardPage() {
  const t = await getTranslations("Dashboard")
  
  return (
    <div>
      <h1>{t("title")}</h1>
      <p>{t("welcome", { name: "Juan" })}</p>
    </div>
  )
}
```

### Client Components

Use `useTranslations` hook:

```tsx
"use client"

import { useTranslations } from "next-intl"

export function StatsCard() {
  const t = useTranslations("Dashboard.stats")
  
  return (
    <div>
      <span>{t("glucose")}</span>
      <span>{t("insulin")}</span>
    </div>
  )
}
```

### Navigation

Always use locale-aware navigation from `@/i18n/navigation`:

```tsx
// Client components
"use client"

import { Link, useRouter, usePathname } from "@/i18n/navigation"

export function Nav() {
  const router = useRouter()
  const pathname = usePathname()
  
  return (
    <nav>
      <Link href="/dashboard">Dashboard</Link>
      <button onClick={() => router.push("/settings")}>
        Settings
      </button>
    </nav>
  )
}
```

```tsx
// Server components - redirect requires locale
import { redirect } from "@/i18n/navigation"
import { getLocale } from "next-intl/server"

export default async function ProtectedPage() {
  const isAuth = await checkAuth()
  
  if (!isAuth) {
    const locale = await getLocale()
    redirect({ href: "/", locale })
  }
  
  return <div>Protected content</div>
}
```

### Get Current Locale

```tsx
// Client components
import { useLocale } from "next-intl"

const locale = useLocale() // "es" or "en"

// Server components
import { getLocale } from "next-intl/server"

const locale = await getLocale()
```

## Interpolation & Formatting

### Variables

```json
{
  "greeting": "Hello, {name}!",
  "items": "You have {count} items"
}
```

```tsx
t("greeting", { name: "Maria" })  // "Hello, Maria!"
t("items", { count: 5 })          // "You have 5 items"
```

### Pluralization

```json
{
  "records": "{count, plural, =0 {No records} one {# record} other {# records}}"
}
```

```tsx
t("records", { count: 0 })  // "No records"
t("records", { count: 1 })  // "1 record"
t("records", { count: 5 })  // "5 records"
```

### Rich Text

```json
{
  "terms": "By signing up, you agree to our <link>Terms of Service</link>"
}
```

```tsx
t.rich("terms", {
  link: (chunks) => <a href="/terms">{chunks}</a>
})
```

## LocaleSwitcher

A pre-built component is available at `@/components/LocaleSwitcher`:

```tsx
import { LocaleSwitcher } from "@/components/LocaleSwitcher"

// Renders a dropdown with available locales
<LocaleSwitcher />
```

## Configuration

### Routing (`src/i18n/routing.ts`)

```ts
import { defineRouting } from "next-intl/routing"

export const routing = defineRouting({
  locales: ["es", "en"],
  defaultLocale: "es",
  localePrefix: "as-needed", // Hide prefix for default locale
})
```

### Adding a New Locale

1. Add locale to `routing.ts`:
   ```ts
   locales: ["es", "en", "pt"]
   ```

2. Create message file `messages/pt.json`

3. Update `LocaleSwitcher.tsx` with locale name/flag:
   ```ts
   const localeNames = { es: "EspaÃ±ol", en: "English", pt: "PortuguÃªs" }
   const localeFlags = { es: "ðŸ‡ªðŸ‡¸", en: "ðŸ‡ºðŸ‡¸", pt: "ðŸ‡§ðŸ‡·" }
   ```

## Best Practices

1. **Use namespaces** - Group translations by feature/page
2. **Keep keys semantic** - Use `submitButton` not `button1`
3. **Server components first** - Use `getTranslations` when possible
4. **Always use i18n navigation** - Import `Link`, `useRouter` from `@/i18n/navigation`
5. **Sync translations** - Keep all locale files in sync with the same keys
